# -*- coding: utf-8 -*-
"""Automatic Text Summarization using Sentence Ranking.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1idhxkBvbr-48nT8D4XFzVe3zgRAkMAQJ

# **Prepare Packages/Modules/Functions**
"""

import numpy as np
import pandas as pd
import nltk
nltk.download('punkt')
import re

"""# **Text Preprocessing**

**Contoh teks yang akan dirangkum**
"""

text_str = '''
Pada zaman dahulu di sebuah perkampungan nelayan Pantai Air Manis di daerah Padang, Sumatera Barat hiduplah seorang janda bernama Mande Rubayah bersama seorang anak laki-lakinya yang bernama Malin Kundang. Mande Rubayah amat menyayangi dan memanjakan Malin Kundang. Malin adalah seorang anak yang rajin dan penurut.
Mande Rubayah sudah tua, ia hanya mampu bekerja sebagai penjual kue untuk mencupi kebutuhan ia dan anak tunggalnya. Suatu hari, Malin jatuh-sakit. Sakit yang amat keras, nyawanya hampir melayang namun akhirnya ia dapat diseiamatkan-berkat usaha keras ibunya. Setelah sembuh dari sakitnya ia semakin disayang. Mereka adalah ibu dan anak yang saling menyayangi. Kini, Malin sudah dewasa ia meminta izin kepada ibunya untuk pergi merantau ke kota, karena saat itu sedang ada kapal besar merapat di Pantai Air Manis.
“Jangan Malin, ibu takut terjadi sesuatu denganmu di tanah rantau sana. Menetaplah saja di sini, temani ibu,” ucap ibunya sedih setelah mendengar keinginan Malin yang ingin merantau.
“Ibu tenanglah, tidak akan terjadi apa-apa denganku,” kata Malin sambil menggenggam tangan ibunya. “Ini kesempatan Bu, kerena belum tentu setahun sekali ada kapal besar merapat di pantai ini. Aku ingin mengubah nasib kita Bu, izinkanlah” pinta Malin memohon.
“Baiklah, ibu izinkan. Cepatlah kembali, ibu akan selalu menunggumu Nak,” kata ibunya sambil menangis. Meski dengan berat hati akhirnya Mande Rubayah mengizinkan anaknya pergi. Kemudian Malin dibekali dengan nasi berbungkus daun pisang sebanyak tujuh bungkus, “Untuk bekalmu di perjalanan,” katanya sambil menyerahkannya pada Malin. Setelah itu berangkatiah Malin Kundang ke tanah rantau meninggalkan ibunya sendirian.
Hari-hari terus berlalu, hari yang terasa lambat bagi Mande Rubayah. Setiap pagi dan sore Mande Rubayah memandang ke laut, “Sudah sampai manakah kamu berlayar Nak?” tanyanya dalam hati sambil terus memandang laut. la selalu mendo’akan anaknya agar selalu selamat dan cepat kembali.
Beberapa waktu kemudian jika ada kapal yang datang merapat ia selalu menanyakan kabar tentang anaknya. “Apakah kalian melihat anakku, Malin? Apakah dia baik-baik saja? Kapan ia pulang?” tanyanya. Namun setiap ia bertanya pada awak kapal atau nahkoda tidak pernah mendapatkan jawaban. Malin tidak pernah menitipkan barang atau pesan apapun kepada ibunya.
Bertahun-tahun Mande Rubayah terus bertanya namun tak pernah ada jawaban hingga tubuhnya semakin tua, kini ia jalannya mulai terbungkuk-bungkuk. Pada suatu hari Mande Rubayah mendapat kabar dari nakhoda dulu membawa Malin, nahkoda itu memberi kabar bahagia pada Mande Rubayah.
“Mande, tahukah kau, anakmu kini telah menikah dengan gadis cantik, putri seorang bangsawan yang sangat kaya raya,” ucapnya saat itu.
Mande Rubayah amat gembira mendengar hal itu, ia selalu berdoa agar anaknya selamat dan segera kembali menjenguknya, sinar keceriaan mulai mengampirinya kembali. Namun hingga berbulan-bulan semenjak ia menerima kabar Malin dari nahkoda itu, Malin tak kunjung kembali untuk menengoknya.
“Malin cepatlah pulang kemari Nak, ibu sudah tua Malin, kapan kau pulang…,” rintihnya pilu setiap malam. Ia yakin anaknya pasti datang. Benar saja tak berapa lama kemudian di suatu hari yang cerah dari kejauhan tampak sebuah kapal yang megah nan indah berlayar menuju pantai. Orang kampung berkumpul, mereka mengira kapal itu milik seorang sultan atau seorang pangeran. Mereka menyambutnya dengan gembira.
Ketika kapal itu mulai merapat, terlihat sepasang anak muda berdiri di anjungan. Pakaian mereka berkiiauan terkena sinar matahari. Wajah mereka cerah dihiasi senyum karena bahagia disambut dengan meriah. Mande Rubayah juga ikut berdesakan mendekati kapal. Jantungnya berdebar keras saat melihat lelaki muda yang berada di kapal itu, ia sangat yakin sekali bahwa lelaki muda itu adalah anaknya, Malin Kundang. Belum sempat para sesepuh kampung menyambut, Ibu Malin terlebih dahulu menghampiri Malin. la langsung memeluknya erat, ia takut kehilangan anaknya lagi.
“Malin, anakku. Kau benar anakku kan?” katanya menahan isak tangis karena gembira, “Mengapa begitu lamanya kau tidak memberi kabar?”
Malin terkejut karena dipeluk wanita tua renta yang berpakaian compang—camping itu. Ia tak percaya bahwa wanita itu adalah ibunya. Sebelum dia sempat berpikir berbicara, istrinya yang cantik itu meludah sambil berkata, “Wanita jelek inikah ibumu? Mengapa dahulu kau bohong padaku!” ucapnya sinis, “Bukankah dulu kau katakan bahwa ibumu adalah seorang bangsawan yang sederajat denganku?!”
Mendengar kata-kata pedas istrinya, Malin Kundang langsung mendorong ibunya hingga terguling ke pasir, “Wanita gila! Aku bukan anakmu!” ucapnya kasar.
Mande Rubayah tidak percaya akan perilaku anaknya, ia jatuh terduduk sambil berkata, “Malin, Malin, anakku. Aku ini ibumu, Nak! Mengapa kau jadi seperti ini Nak?!” Malin Kundang tidak memperdulikan perkataan ibunya. Dia tidak akan mengakui ibunya. la malu kepada istrinya. Melihat wanita itu beringsut hendak memeluk kakinya, Malin menendangnya sambil berkata, “Hai, wanita gila! lbuku tidak seperti engkau! Melarat dan kotor!” Wanita tua itu terkapar di pasir, menangis, dan sakit hati.
Orang-orang yang meilhatnya ikut terpana dan kemudian pulang ke rumah masing-masing. Mande Rubayah pingsan dan terbaring sendiri. Ketika ia sadar, Pantai Air Manis sudah sepi. Dilihatnya kapal Malin semakin menjauh. Ia tak menyangka Malin yang dulu disayangi tega berbuat demikian. Hatinya perih dan sakit, lalu tangannya ditengadahkannya ke langit. Ia kemudian berdoa dengan hatinya yang pilu, “Ya, Tuhan, kalau memang dia bukan anakku, aku maafhan perbuatannya tadi. Tapi kalau memang dia benar anakku yang bernama Malin Kundang, aku mohon keadilanmu, Ya Tuhan!” ucapnya pilu sambil menangis. Tak lama kemudian cuaca di tengah laut yang tadinya cerah, mendadak berubah menjadi gelap. Hujan tiba-tiba turun dengan teramat lebatnya. Tiba-tiba datanglah badai besar, menghantam kapal Malin Kundang. Laiu sambaran petir yang menggelegar. Saat itu juga kapal hancur berkeping- keping. Kemudian terbawa ombak hingga ke pantai.
Esoknya saat matahari pagi muncul di ufuk timur, badai telah reda. Di kaki bukit terlihat kepingan kapal yang telah menjadi batu. Itulah kapal Malin Kundang! Tampak sebongkah batu yang menyerupai tubuh manusia. Itulah tubuh Malin Kundang anak durhaka yang kena kutuk ibunya menjadi batu karena telah durhaka. Disela-sela batu itu berenang-renang ikan teri, ikan belanak, dan ikan tengiri. Konon, ikan itu berasal dari serpihan tubuh sang istri yang terus mencari Malin Kundang.
Sampai sekarang jika ada ombak besar menghantam batu-batu yang mirip kapal dan manusia itu, terdengar bunyi seperti lolongan jeritan manusia, terkadang bunyinya seperti orang meratap menyesali diri, “Ampun, Bu…! Ampuun!” konon itulah suara si Malin Kundang, anak yang durhaka pada ibunya.
'''

"""**Split sentences**"""

text_str = text_str.replace('\n', '')
sentences = re.split('\. |\.',text_str)
sentences

# hapus tanda baca, angka, dan karakter khusus
clean_sentences = pd.Series(sentences).str.replace("[^a-zA-Z]", " ")

# membuat huruf kecil
clean_sentences = [s.lower() for s in clean_sentences]

clean_sentences

len(clean_sentences)

"""# **Sentences Ranking**"""

# vektor Wikipedia 2014 + Gigaword 5 GloVe yang telah dilatih sebelumnya
# dari nlpstanford

#import glove
!wget http://nlp.stanford.edu/data/glove.6B.zip
!unzip glove*.zip

# Ekstrak kata embeddings atau vektor kata
word_embeddings = {}
f = open('glove.6B.100d.txt', encoding='utf-8')
for line in f:
    values = line.split()
    word = values[0]
    coefs = np.asarray(values[1:], dtype='float32')
    word_embeddings[word] = coefs
f.close()

len(word_embeddings)

"""**Filtering (Stopword-Removal)**"""

"""
Singkirkan stopwords (kata-kata yang umum digunakan dalam suatu 
bahasa) yang ada dalam kalimat.
"""

nltk.download('stopwords')
from nltk.corpus import stopwords
stop_words = stopwords.words('indonesian')

# Tentukan fungsi untuk menghapus stopword ini dari dataset

# Fungsi untuk menghapus stopword
def remove_stopwords(sen):
    sen_new = " ".join([i for i in sen if i not in stop_words])
    return sen_new

# hapus stopwords dari kalimat
clean_sentences_SR = [remove_stopwords(r.split()) for r in clean_sentences]

clean_sentences_SR

# Ekstrak vektor kata
"""
Gunakan clean_sentences untuk membuat 
vektor kalimat (vector senteces) dalam data
dengan bantuan vektor kata GloVe
"""

word_embeddings = {}
f = open('glove.6B.100d.txt', encoding='utf-8')
for line in f:
    values = line.split()
    word = values[0]
    coefs = np.asarray(values[1:], dtype='float32')
    word_embeddings[word] = coefs
f.close()

'''
Sekarang membuat vektor untuk kalimat.
Yang pertama ambil vektor (masing2 berukuran 100 elemen)
untuk kata2 penyusun dalam sebuah kalimat dan kemudian 
mengambil mean/rata2 dari vektor tsb untuk sampai 
pada vektor gabungan untuk kalimat tersebut
'''

sentence_vectors = []
for i in clean_sentences_SR:
  if len(i) != 0:
    v = sum([word_embeddings.get(w, np.zeros((100,))) for w in i.split()])/(len(i.split())+0.001)
  else:
    v = np.zeros((100,))
  sentence_vectors.append(v)

# similarity matrix
sim_mat = np.zeros([len(sentences), len(sentences)])

sim_mat

"""**Membuat Score**"""

from sklearn.metrics.pairwise import cosine_similarity

for i in range(len(sentences)):
  for j in range(len(sentences)):
    if i != j:
      sim_mat[i][j] = cosine_similarity(sentence_vectors[i].reshape(1,100), sentence_vectors[j].reshape(1,100))[0,0]

import networkx as nx

nx_graph = nx.from_numpy_array(sim_mat)
scores = nx.pagerank(nx_graph)

scores

#mengambil ranking teratas
#mengurutkan ranking
ranked_sentences = sorted(((scores[i],s) for i,s in enumerate(sentences)), reverse=True)

ranked_sentences

n = int(0.25*len(sentences))

# Ekstrak 25% kalimat teratas sebagai ringkasan
# besar presentase ekstrak dapat diatur pada nilai di variabel n
for i in range(n):
  print(ranked_sentences[i][1], end='.\n')

"""# **Evaluate**

Evaluasi yang dilakukan menggunakan Rouge. Dimana nantinya hasil evaluasi rouge yang didapatkan merupakan hasil perbandingan antara hasil ringkasan menggunakan model yang dibuat dengan hasil ringkasan menggunakan online summarization. Adapun online summarization yang digunakan https://studycorgi.com/free-writing-tools/summary-generator/. Dimana jenis rouge yang digunakan :
- Rouge 1 : Mengukur tingkat kecocokan unigram (banyak pengelompokam token/kata) antara hasil model dengan referensi
- Rouge 2 : Mengukur tingkat kecocokan bigram (2 pengelompokam token/kata) antara hasil model dengan referensi
- Rouge L : Mengukur urutan umum terpanjang (LCS) R1 dan R2 terhadap referensi
"""

pip install git+https://github.com/tagucci/pythonrouge.git

!pip install rouge-score

from rouge_score import rouge_scorer

scorer = rouge_scorer.RougeScorer(['rouge1', 'rouge2', 'rougeL'], use_stemmer=True)

resultSR = '''
“Malin cepatlah pulang kemari Nak, ibu sudah tua Malin, kapan kau pulang…,” rintihnya pilu setiap malam.
Itulah tubuh Malin Kundang anak durhaka yang kena kutuk ibunya menjadi batu karena telah durhaka.
Sebelum dia sempat berpikir berbicara, istrinya yang cantik itu meludah sambil berkata, “Wanita jelek inikah ibumu? Mengapa dahulu kau bohong padaku!” ucapnya sinis, “Bukankah dulu kau katakan bahwa ibumu adalah seorang bangsawan yang sederajat denganku?!”Mendengar kata-kata pedas istrinya, Malin Kundang langsung mendorong ibunya hingga terguling ke pasir, “Wanita gila! Aku bukan anakmu!” ucapnya kasar.
Kemudian Malin dibekali dengan nasi berbungkus daun pisang sebanyak tujuh bungkus, “Untuk bekalmu di perjalanan,” katanya sambil menyerahkannya pada Malin.
Tapi kalau memang dia benar anakku yang bernama Malin Kundang, aku mohon keadilanmu, Ya Tuhan!” ucapnya pilu sambil menangis.
Malin tidak pernah menitipkan barang atau pesan apapun kepada ibunya.
Pada zaman dahulu di sebuah perkampungan nelayan Pantai Air Manis di daerah Padang, Sumatera Barat hiduplah seorang janda bernama Mande Rubayah bersama seorang anak laki-lakinya yang bernama Malin Kundang.
Mande Rubayah tidak percaya akan perilaku anaknya, ia jatuh terduduk sambil berkata, “Malin, Malin, anakku.
Sampai sekarang jika ada ombak besar menghantam batu-batu yang mirip kapal dan manusia itu, terdengar bunyi seperti lolongan jeritan manusia, terkadang bunyinya seperti orang meratap menyesali diri, “Ampun, Bu…! Ampuun!” konon itulah suara si Malin Kundang, anak yang durhaka pada ibunya.
Aku ingin mengubah nasib kita Bu, izinkanlah” pinta Malin memohon.
Melihat wanita itu beringsut hendak memeluk kakinya, Malin menendangnya sambil berkata, “Hai, wanita gila! lbuku tidak seperti engkau! Melarat dan kotor!” Wanita tua itu terkapar di pasir, menangis, dan sakit hati.
Suatu hari, Malin jatuh-sakit.
Mande Rubayah amat menyayangi dan memanjakan Malin Kundang.
“Mande, tahukah kau, anakmu kini telah menikah dengan gadis cantik, putri seorang bangsawan yang sangat kaya raya,” ucapnya saat itu.
Kau benar anakku kan?” katanya menahan isak tangis karena gembira, “Mengapa begitu lamanya kau tidak memberi kabar?”Malin terkejut karena dipeluk wanita tua renta yang berpakaian compang—camping itu.
Tiba-tiba datanglah badai besar, menghantam kapal Malin Kundang.
Malin adalah seorang anak yang rajin dan penurut.
“Jangan Malin, ibu takut terjadi sesuatu denganmu di tanah rantau sana.
'''

resultOS = '''
Pada zaman dahulu di sebuah perkampungan nelayan Pantai Air Manis di daerah Padang, Sumatera Barat hiduplah seorang janda bernama Mande Rubayah bersama seorang anak laki-lakinya yang bernama Malin Kundang. Mande Rubayah amat menyayangi dan memanjakan Malin Kundang. Malin adalah seorang anak yang rajin dan penurut. Kini, Malin sudah dewasa ia meminta izin kepada ibunya untuk pergi merantau ke kota, karena saat itu sedang ada kapal besar merapat di Pantai Air Manis."Jangan Malin, ibu takut terjadi sesuatu denganmu di tanah rantau sana. Menetaplah saja di sini, temani ibu," ucap ibunya sedih setelah mendengar keinginan Malin yang ingin merantau."Ibu tenanglah, tidak akan terjadi apa-apa denganku," kata Malin sambil menggenggam tangan ibunya."Ini kesempatan Bu, kerena belum tentu setahun sekali ada kapal besar merapat di pantai ini. Setelah itu berangkatiah Malin Kundang ke tanah rantau meninggalkan ibunya sendirian. Beberapa waktu kemudian jika ada kapal yang datang merapat ia selalu menanyakan kabar tentang anaknya."Apakah kalian melihat anakku, Malin? Pada suatu hari Mande Rubayah mendapat kabar dari nakhoda dulu membawa Malin, nahkoda itu memberi kabar bahagia pada Mande Rubayah."Mande, tahukah kau, anakmu kini telah menikah dengan gadis cantik, putri seorang bangsawan yang sangat kaya raya," ucapnya saat itu. Namun hingga berbulan-bulan semenjak ia menerima kabar Malin dari nahkoda itu, Malin tak kunjung kembali untuk menengoknya."Malin cepatlah pulang kemari Nak, ibu sudah tua Malin, kapan kau pulang...," rintihnya pilu setiap malam. Jantungnya berdebar keras saat melihat lelaki muda yang berada di kapal itu, ia sangat yakin sekali bahwa lelaki muda itu adalah anaknya, Malin Kundang. Mande Rubayah tidak percaya akan perilaku anaknya, ia jatuh terduduk sambil berkata, "Malin, Malin, anakku. Ia tak menyangka Malin yang dulu disayangi tega berbuat demikian. Tapi kalau memang dia benar anakku yang bernama Malin Kundang, aku mohon keadilanmu, Ya Tuhan!" ucapnya pilu sambil menangis. Tiba-tiba datanglah badai besar, menghantam kapal Malin Kundang. Itulah kapal Malin Kundang! Itulah tubuh Malin Kundang anak durhaka yang kena kutuk ibunya menjadi batu karena telah durhaka. Konon, ikan itu berasal dari serpihan tubuh sang istri yang terus mencari Malin Kundang. Ampuun!" konon itulah suara si Malin Kundang, anak yang durhaka pada ibunya.
'''

scoresSR = scorer.score(resultSR,resultOS)

scoresSR